<!DOCTYPE html>
<html>
	<head>
		<script src="error.js"> </script>
		<title> OCDAP SubStringSearch Practice </title>
		<script>
			//attribute list from eclipse java file
			var subString = prompt("Please type the sub-string you would like to search for:"); //holds user's subString to be found
			var subArray = subString.split(""); //converts String to String array
			var subLength = subArray.length; //length of subArray
			
			var bigString = ""; //holds String version of generated letters
			var bigArray = []; //holds randomly generated characters; find subString in here
			
			var compString = ""; //holds String version of letters complementary to generate letters (see randomString comments)
			var compArray = []; //holds complementary characters
			
			//var displayArray = []; //string displayed for user; subString in capitals and larger text
			var posFound = []; //posFound[i] is the ith occurence of subString
			var count = 0; //number of times subString found
			var bigNum = 459; //how long bigString is
			
			//generates bigString and compString 
			//uses those Strings to make bigArray and compArray
			function randomString()
			{
				for (p=0; p<=bigNum; p++)
				{
					//local variables
					var letterIndex = 0; //integer representing a, t, c, or g
					var randLetter = ""; //stores random letter
					var compLetter = ""; //stores letter complementary to randLetter (see if consequences for details)
					
					//generates random number from 1-4; rounded down
					letterIndex = Math.floor((Math.random()*4)+1); 
					
					//sets letters to numbers generated
					if (letterIndex == 1) 
					{
						//a & t are complementary to each other
						randLetter = "a";
						compLetter = "t";
					}
					
					else if (letterIndex == 2) 
					{
						//a & t are complementary to each other
						randLetter = "t";
						compLetter = "a";
					}
					
					else if (letterIndex == 3) 
					{
						//c & g are complementary to each other
						randLetter = "c";
						compLetter = "g";
					}
					
					else 
					{
						//c & g are complementary to each other
						randLetter = "g";
						compLetter = "c";
					}
					
					//create Strings of letters
					bigString = bigString + randLetter;
					compString = compString + compLetter;
				}
				
				//convert Strings of letters to String arrays
				bigArray = bigString.split("");
				compArray = compString.split("");
			}
			
			//looks thru bigArray for all instances of subArray
			//stores starting index values of subString locations in indexFound[]
			function findSubString()
			{
				//looks through all 459 characters
				for (i=0; i<(bigNum-subLength); i++) //make sure i+j not off array length
				{
					var looking = true;
					//looks through all subString characters
					for (j=0; j<subLength && looking; j++)
					{
						//if current character does not match character in subArray
						if (bigArray[i+j] != subArray[j]) {looking = false;}
					}
					//inner loop ends if a mismatch (looking = false) -> goes on to next i
					//or found complete match (looking still = true) -> store in array of positions found, then go to next i
					if (looking)
					{
						posFound[count] = i;
						count++;
					}
				}
			}
			
			//displays subString and its instances indexes
			function displayArrays()
			{
				document.writeln("Your sub-string:<br />"); //.writeln() not working to put on new line?
				
				//goes through length of subArray[]
				for (h=0; h<subLength; h++)
				{
					document.write(subArray[h]);
				}
				document.writeln("<br /><br />"); 
				
				document.writeln("Instances of your sub-string found at indexes:<br />");
				
				//goes through length of posFound[]
				for (h=0; h<count; h++)
				{
					document.write(posFound[h] + "&nbsp;&nbsp;&nbsp;"); //&nbsp; = space
					
					//if h is in the last slot of posFound[]
					//if (h == count-1){document.write(posFound[h]);}
				}
				document.writeln("<br /><br />");
			}
	
			//draws generated sequence with markers to show where sub-string instances are
			function drawFound()
			{
				//sets canvasS as element to be edited
				var canvasS = document.getElementById('searchCanvas');
			
				//use to get CanvasRenderingConext2D -> needed to draw
				var contextS = canvasS.getContext('2d');
			
				//string containing font style, size and family
				//style = normal(default), italic, or bold
				contextS.font = 'normal 15pt Calibri';
				
				var startPos = 0; //index number of starting index
				var canvasPosX = 10; //x position relative to canvas of first character in sequence
				var canvasPosY = 90; //y position relative to canvas of first character in sequence
				var spacingX = 10; //amount of space in pixels between each character on x-axis
				var spacingY = 30; //amount of space in pixels between characters in original string versus complementary string
				
				/* not working
				var moveX = canvasPosX + (spacingX*pullBack); //calculates x position where character should be
				var moveY = canvasPosY + spacingY; //calculates y position where complementary character should be
				*/
		
				var pullBack = 0; //acts like w, except will be set back to 0 if new line needs to start
				
				contextS.fillText('Edited sequence:', canvasPosX, 15); //will have to force the next text down using x,y instead of <br />
				
				//document.writeln("Edited sequence :<br />");
				
				//*DRAW RECTANGLE (if apply, have to check), THEN CHARACTER*
				//*PROBLEM: Only wants to draw one rectangle, no matter what row it is on (i.e. if first instance was at 108, will draw that, but none else*
				
				//goes through all 456 characters
				for (w=0; w<bigNum; w++)
				{				
					//if the current character's index value matches a posFound[] value
					if (w == posFound[startPos])
					{
						//debug
						alert("I'm at an instance of subString");
						
						//if current character is on first line
						if (w > -1 && w < 94)
						{
							//debug
							alert("I've found an instance on the first line.");
							
							//should probably make a separate fxn for this...
							//draws rectangle where subString characters will be drawn
							contextS.fillStyle = "cyan";
							contextS.fillRect(canvasPosX + (spacingX*pullBack), canvasPosY-spacingX, 27, 10); //for original strand
							
							//draws rectangle where complementary subString characters will be drawn
							contextS.fillStyle = "yellow";
							contextS.fillRect(canvasPosX + (spacingX*pullBack), (canvasPosY + spacingY)-spacingX, 27, 10); //for complementary strand 
							
							//debug
							alert("I drew the boxes for ths first line instance");
						}
					
						//if current character looking at is not on first line
						else if (w > 93)
						{
							//x coordinate of current character
							//var findX = ((w-93)*spacingX)+canvasPosX; //not working
							
							//debug
							alert("I've found an instance on line 2 or later.");
							
							//draws rectangle where subString characters will be drawn
							contextS.fillStyle = "cyan";
							contextS.fillRect(((w-93)*spacingX)+canvasPosX, canvasPosY-spacingX, 27, 10); //for original strand; x, y (upper left), width, height
							
							//draws rectangle where complementary subString characters will be drawn
							context.fillStyle = "yellow";
							contextS.fillRect(((w-93)*spacingX)+canvasPosX, (canvasPosY+spacingY)-spacingX, 27, 10);
							
							//debug
							alert("I drew the boxes for this 2nd line or later instance.");
						}
						//document.write("<span style=\"font-size: 200%\"> &lt;"); // &lt; = <
						startPos++;
					}
					
					//continues drawing out characters in generated sequence
					//if gets to edge of canvas, will have to adjust y as well
					//sets fillStyle back to black in case a rectangle had to be drawn
					contextS.fillStyle = "black";
					contextS.fillText(bigArray[w], canvasPosX + (spacingX*pullBack), canvasPosY);
					
					
					//draws complementary character below
					contextS.fillText(compArray[w], canvasPosX + (spacingX*pullBack), canvasPosY + spacingY);
					
					//increments pullBack as w increments
					pullBack++;
					
					/*
					//continues writing out characters in the generated sequence
					document.write(bigArray[w]);
					
					//if the current character's index value matches the end position
					if (w == posFound[startPos] + (subLength-1))
					{
						document.write("&gt;</span>"); //&gt; = >
						startPos++;
					}
					*/
					
					//moves to new line after 31 codons (93 characters)
					//resets appropriate variable to original values (pullBack)
					//moves y position to be further down canvas
					if ((w+1)%93 == 0)
					{
						pullBack = 0;
						canvasPosY = canvasPosY + (spacingY * 5);
						
						//document.writeln("<br />");
					}
				}
				//document.writeln("<br />");
			}
		</script>
	</head>
	
	<body>
		<h1>OCDAP SubStringSearch Practice </h1>
		
		<script>
			//generates bigString and compString 
			//uses those Strings to make bigArray and compArray
			randomString();
			
			//looks thru bigArray for all instances of subArray
			//stores starting index values of subString locations in indexFound[]
			findSubString();
			
			//displays subString and its instances indexes
			displayArrays();
		</script>
		
		<!--separated fxns out so canvas would be made after document.write info, but before stuff actually want to draw-->
		<!--create canvas-->
		<!--border not required, but nice to see where it is for practice purposes-->
		<canvas id="searchCanvas" width="1000" height="1000" 
				style="border:1px solid black;"> </canvas>
		
		<script>
			//draws generated sequence with markers to show where sub-string instances are
			drawFound();
		</script>
	</body>
</html>